resources:
  jobs:
    Generate_NHP_Data_Inputs:
      name: Generate NHP Data (Inputs)
      webhook_notifications:
        on_success:
          - id: 11be34cb-f1f0-42ca-99d8-e7b3e75e20ca
        on_failure:
          - id: 11be34cb-f1f0-42ca-99d8-e7b3e75e20ca
      tasks:
        - task_key: run_inputs_data
          condition_task:
            op: EQUAL_TO
            left: "{{job.parameters.run_inputs_data}}"
            right: "True"
        - task_key: catchments
          depends_on:
            - task_key: run_inputs_data
              outcome: "true"
          python_wheel_task:
            package_name: nhp_data
            entry_point: inputs_data-catchments
            parameters:
              - "{{job.parameters.save_path}}"
          job_cluster_key: nhp_inputs_data_extract
          libraries:
            - whl: ../dist/*.whl
        - task_key: extract_age_sex
          depends_on:
            - task_key: catchments
          python_wheel_task:
            package_name: nhp_data
            entry_point: inputs_data-age_sex
            parameters:
              - "{{job.parameters.save_path}}"
          job_cluster_key: nhp_inputs_data_extract
          libraries:
            - whl: ../dist/*.whl
        - task_key: extract_baseline
          depends_on:
            - task_key: extract_age_sex
          python_wheel_task:
            package_name: nhp_data
            entry_point: inputs_data-baseline
            parameters:
              - "{{job.parameters.save_path}}"
          job_cluster_key: nhp_inputs_data_extract
          libraries:
            - whl: ../dist/*.whl
        - task_key: extract_covid_adjustment
          depends_on:
            - task_key: extract_baseline
          python_wheel_task:
            package_name: nhp_data
            entry_point: inputs_data-covid_adjustment
            parameters:
              - "{{job.parameters.save_path}}"
          job_cluster_key: nhp_inputs_data_extract
          libraries:
            - whl: ../dist/*.whl
        - task_key: extract_diagnoses
          depends_on:
            - task_key: extract_covid_adjustment
          python_wheel_task:
            package_name: nhp_data
            entry_point: inputs_data-diagnoses
            parameters:
              - "{{job.parameters.save_path}}"
          job_cluster_key: nhp_inputs_data_extract
          libraries:
            - whl: ../dist/*.whl
        - task_key: extract_expat_repat
          depends_on:
            - task_key: extract_diagnoses
          python_wheel_task:
            package_name: nhp_data
            entry_point: inputs_data-expat_repat
            parameters:
              - "{{job.parameters.save_path}}"
          job_cluster_key: nhp_inputs_data_extract
          libraries:
            - whl: ../dist/*.whl
        - task_key: extract_procedures
          depends_on:
            - task_key: extract_expat_repat
          python_wheel_task:
            package_name: nhp_data
            entry_point: inputs_data-procedures
            parameters:
              - "{{job.parameters.save_path}}"
          job_cluster_key: nhp_inputs_data_extract
          libraries:
            - whl: ../dist/*.whl
        - task_key: extract_rates
          depends_on:
            - task_key: extract_procedures
          python_wheel_task:
            package_name: nhp_data
            entry_point: inputs_data-rates
            parameters:
              - "{{job.parameters.save_path}}"
          job_cluster_key: nhp_inputs_data_extract
          libraries:
            - whl: ../dist/*.whl
        - task_key: extract_wli
          depends_on:
            - task_key: extract_rates
          python_wheel_task:
            package_name: nhp_data
            entry_point: inputs_data-wli
            parameters:
              - "{{job.parameters.save_path}}"
          job_cluster_key: nhp_inputs_data_extract
          libraries:
            - whl: ../dist/*.whl
        - task_key: extract_inequalities
          depends_on:
            - task_key: extract_wli
          python_wheel_task:
            package_name: nhp_data
            entry_point: inputs_data-inequalities
            parameters:
              - "{{job.parameters.save_path}}"
          job_cluster_key: nhp_inputs_data_extract
          libraries:
            - whl: ../dist/*.whl
      job_clusters:
        - job_cluster_key: nhp_inputs_data_extract
          new_cluster:
            cluster_name: ""
            spark_version: 15.4.x-scala2.12
            spark_env_vars:
              PYPYTHON_wheel: /databricks/python3/bin/python3
            instance_pool_id: 0129-130615-maw351-pool-pss8mvfy
            data_security_mode: SINGLE_USER
            runtime_engine: PHOTON
            autoscale:
              min_workers: 2
              max_workers: 8
      tags:
        group: nhp_data
        env: ${bundle.target}
      queue:
        enabled: true
      parameters:
        - name: run_inputs_data
          default: "True"
        - name: save_path
          default: /Volumes/nhp/inputs_data/files/dev
